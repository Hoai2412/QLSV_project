<div class="score-container">
  <h2 class="title"><i class="fa fa-history"></i> LỊCH SỬ SỬA ĐIỂM</h2>

  <div style="margin-bottom:12px;">
    <b>Lớp học phần:</b> <span id="malhp-txt"></span>
    <button onclick="history.back()" class="btn-mini btn-history">Quay lại</button>
  </div>

  <table class="table-score">
    <thead>
      <tr>
        <th>Thời gian</th>
        <th>Người sửa</th>
        <th>Mã SV</th>
        <th>Họ tên</th>
        <th>Nội dung</th>
      </tr>
    </thead>
    <tbody id="his-tbody">
      <tr><td colspan="5" style="text-align:center;">Đang tải...</td></tr>
    </tbody>
  </table>
</div>

<script>
  async function loadHistory() {
    const params = new URLSearchParams(window.location.search);
    const malhp = params.get("malhp");
    document.getElementById("malhp-txt").innerText = malhp || "--";

    const tbody = document.getElementById("his-tbody");
    if (!malhp) {
      tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;">Thiếu malhp</td></tr>`;
      return;
    }

    const res = await fetch(`/api/diem/admin/history/${encodeURIComponent(malhp)}`);
    const json = await res.json();

    if (!json.success || !Array.isArray(json.data) || json.data.length === 0) {
      tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;">Chưa có lịch sử</td></tr>`;
      return;
    }

    tbody.innerHTML = "";
    json.data.forEach(r => {
      tbody.innerHTML += `
        <tr>
          <td>${new Date(r.ThoiGian).toLocaleString("vi-VN")}</td>
          <td>${r.NguoiSua || ""}</td>
          <td>${r.MaSV}</td>
          <td>${r.HoTen}</td>
          <td>${r.NoiDung || ""}</td>
        </tr>
      `;
    });
  }

  document.addEventListener("DOMContentLoaded", loadHistory);
</script>
